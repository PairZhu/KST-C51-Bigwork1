# KST-C51-Bigwork1
 单片机第一次大作业
## 功能描述
1.测量摆动周期
可以测量计算摆动单个周期时间
2.计算三线摆对应输入参数的转动惯量
可以输入三线摆实验测量的参数自动计算转动惯量
## 特点
1.实验错误警告
·如果单次测量中第一次出现两次周期之间的误差大于20%时蜂鸣器会发出较长音警告，并在点阵屏上显示出大感叹号。
2.连续多次测量
·可以仅改变总质量，无需再次输入其他参数即可再次测量并计算出新的结果，并总质量的默认值也是上次的输入值，
可以直接按下回车跳过输入（如需改变质量以外的其他参数需要使用reset按钮重新设置全部参数）。
·连续测量时上次测量错误警告会被消除。
3.可自行设置重力加速
·各地重力加速度不同，参数输入时可自行调整该值（默认值为9.8m/s^2）。
4.良好的交互方式
·使用LCD1602液晶屏和矩阵键盘输入，可以按键输入和删除数字。
·有适量的文字提示输入，输入非法值后也会有提示，并且可以直接修改输入值。
·数码管显示当前剩余需要测量的周期数，测量时液晶屏实时显示当前经过的总时间。
·每次光电门被遮住时都会有短暂的蜂鸣器提示，方便确认该次摆动被正确记录了。
·键盘支持长按（长按住按钮时每隔一段时间就视为短按按下一次），且每个参数均有默认值，如果不需要计算转动惯量，
可以长按住按钮跳过参数输入阶段。
## 使用方法
1.光电门接入电源，输出脚接上P3.3/INT1引脚打开电源。
2.先通过矩阵按键输入要测量的总周期数，按Enter键确认，按ESC键可退格。
3.根据液晶屏上的提示文字输入参数（注意单位和需乘因数），不需要计算转动惯量可长按Enter键到最后一步。
4.液晶屏上出现“EnterToBegin”时轻摇三线摆开始摆动，当摆动稳定后按下Enter，当光电门第一次被遮住时自动开始计时。
5.留意点阵屏和蜂鸣器提示音，若出现点阵屏出现感叹号或蜂鸣器响长音表示测量出现错误，可立即重启重新测量或等此次测量结束后
使用连续测量功能再次测量，错误警告不会终止测量和结果计算，可以忽略该警告。
6.测量结束后液晶屏会显示单次周期时长（ms），和转动惯量（g*m^2）。
7.按下Enter键可以重新输入质量（默认值为上次的输入值），保持其他参数不变，再次测量周期和转动惯量。
## 核心功能实现
1.周期测量
当光电门中间从透光状态被遮住时，光电门输出引脚的电平从高电平变为低电平。
经过N个周期光电门共被遮住2N+1次，使用外部中断1设置模式为下降沿触发来检测光电门状态。
光电门第一次被遮住时启动定时器0设置溢出时间为50ms进行计时。每次定时器溢出，自增一次计数变量。
为减少计时误差，定时器0中断的抢占优先级设为1，其余中断抢占优先级设为0。
光电门第2N+1次被遮住时停止定时器，根据溢出次数和当前定时器寄存器的值以及定时器的初值计算经过的总时间。
总时间除以N得到单个周期的时间
2.键盘输入
按下数字键X时液晶屏打印出对应的字符，并将当前保存值乘10加X。
按下退格键即除以10并在该位置写入空格